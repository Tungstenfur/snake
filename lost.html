<!doctype html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Document</title>
    <link rel="stylesheet" href="index.css" />
    <script src="intro.js" defer></script>
  </head>
  <body id="body">
    <h2 class="typing-text" data-typing id="explode">Wąsz eksplodował</h2>
    <p class="typing-text" data-typing id="explanation">
      Niestety, w czasie zbierania jabłek wąsz uderzył głową o coś i
      eksplodował. Na szczęście, nikt nie ucierpiał, ale wąsz został całkowicie
      zniszczony.
    </p>
    <p class="typing-text" data-typing>---POCZĄTEK RAPORTU---</p>
    <p class="typing-text" data-typing id="raport"></p>
    <script>
      let pieski = localStorage.getItem("pieski") || 0;
      let raport = document.getElementById("raport");
      let params = new URLSearchParams(window.location.search);
      let score = params.get("score");
      let deathType = params.get("deathType");
      if (deathType === "0") deathType = "zderzenie z samym sobą";
      else if (deathType === "1") deathType = "zdzerzenie z ścianą";
      else if (deathType === "2") {
        pieski++;
        localStorage.setItem("pieski", pieski);
        document.getElementById("explode").textContent = "Sukces!";
        document.getElementById("explanation").textContent =
          "Wąsz osiągnął maksymalny wynik! Wąsz osiągnął pełną polimeryzacje i zostanie teraz pocięty na bloki do budowy domów. Gratulacje!";
        deathType = "pełna polimeryzacja";
      }
      const d = new Date();
      if (d.getMinutes() < 10) {
        raport.textContent =
          "Czas: " + d.getHours() + ":0" + d.getMinutes() + "\n";
      } else {
        raport.textContent =
          "Czas: " + d.getHours() + ":" + d.getMinutes() + "\n";
      }
      raport.textContent += "Zebrane jabłka: " + score + "\n";
      raport.textContent += "Przyczyna śmierci: " + deathType;
      if (pieski > 0) {
        raport.textContent += "\nPieski: " + pieski;
      }
      document.addEventListener("DOMContentLoaded", function () {
        let audio;
        if (deathType === "pełna polimeryzacja") {
          audio = new Audio("assets/Soviet_Anthem_8-bit.mp3");
        } else {
          audio = new Audio("assets/Varshavianka_8-Bit.mp3");
        }
        audio.volume = 0.3;
        const removeAudioListeners = () => {
          window.removeEventListener("pointerdown", startAudio);
          window.removeEventListener("keydown", startAudio);
          window.removeEventListener("touchstart", startAudio);
        };
        const startAudio = () => {
          audio
            .play()
            .then(() => {
              removeAudioListeners();
            })
            .catch(() => {});
        };
        audio.play().catch(() => {
          window.addEventListener("pointerdown", startAudio);
          window.addEventListener("keydown", startAudio);
          window.addEventListener("touchstart", startAudio);
        });
      });
    </script>
    <p class="typing-text" data-typing>---KONIEC RAPORTU---</p>
    <script>
      pieski = localStorage.getItem("pieski") || 0;
      if (pieski > 0) {
        document.getElementById("body").innerHTML +=
          '<p class="typing-text" data-typing id="piesekTekst" class="piesek">W nagrodę otrzymujesz pieska</p><img src="assets/won.jpg" id="piesek" class="piesek" /><br>';
      }
    </script>
    <a href="game.html">>ZAGRAJ PONOWNIE</a><br />
    <a href="#" id="quit">>WYJDŹ</a>
    <script>
      document.getElementById("quit").addEventListener("click", function (e) {
        e.preventDefault();
        window.close();
        window.open("about:blank");
      });
    </script>
  </body>
</html>
